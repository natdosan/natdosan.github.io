<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ page.title }}</title>
  <link rel="stylesheet" href="{{ '/assets/css/gallery.css' | relative_url }}">
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap" rel="stylesheet">
</head>
<body>
  <nav class="topnav">
    <a class="brand" href="https://natdosan.github.io">natdosan</a>
    <a class="vlog" href="https://www.youtube.com/@swagmasternat4" target="_blank">vlog</a>
  </nav>
  
  <main>
    {{ content }}
  </main>
</body>
</html>
<script>
document.addEventListener('DOMContentLoaded', async () => {

  function pageSizeFor(page, images) {
    // First two pages are always 4
    if (page <= 2) return 4;

    const start = startIndexFor(page, images);
    const candidates = images.slice(start, start + 6);

    const landscapeCount = candidates.filter(
      img => img.orientation === 'landscape'
    ).length;

    return landscapeCount >= candidates.length / 2 ? 6 : 4;
  }

  function startIndexFor(page, images) {
    let start = 0;
    for (let p = 1; p < page; p++) {
      start += pageSizeFor(p, images);
    }
    return start;
  }

  const response = await fetch('/assets/gallery.json');
  const images = await response.json();

  const params = new URLSearchParams(window.location.search);
  const page = parseInt(params.get('page')) || 1;

  const container = document.querySelector('.gallery');
  const nav = document.querySelector('.pagination');

  const size = pageSizeFor(page, images);
  const start = startIndexFor(page, images);
  const pageImages = images.slice(start, start + size);

  // --- Apply layout class BEFORE render ---
  const landscapeCount = pageImages.filter(
    img => img.orientation === 'landscape'
  ).length;

  container.classList.remove('two-by-two', 'three-by-two');

  const isTwoByTwo = landscapeCount >= pageImages.length / 2 && size === 4;
  container.classList.add(isTwoByTwo ? 'two-by-two' : 'three-by-two');

  // --- Render ---
  pageImages.forEach(img => {
    const figure = document.createElement('figure');
    const image = document.createElement('img');
    const caption = document.createElement('figcaption');

    image.src = img.src;
    image.alt = img.caption;
    image.loading = 'lazy';
    image.decoding = 'async';

    caption.textContent = img.caption;

    figure.appendChild(image);
    figure.appendChild(caption);
    container.appendChild(figure);
  });

  // --- Pagination ---
  if (page > 1) {
    const prev = document.createElement('a');
    prev.href = `?page=${page - 1}`;
    prev.textContent = '← Previous';
    nav.appendChild(prev);
  }

  if (start + size < images.length) {
    const next = document.createElement('a');
    next.href = `?page=${page + 1}`;
    next.textContent = 'Next →';
    nav.appendChild(next);
  }

});
</script>


