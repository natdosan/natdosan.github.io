<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ page.title }}</title>
  <link rel="stylesheet" href="{{ '/assets/css/gallery.css' | relative_url }}">
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap" rel="stylesheet">
</head>
<body>
  <nav class="topnav">
    <a class="brand" href="https://natdosan.github.io">natdosan</a>
    <a class="vlog" href="https://www.youtube.com/@swagmasternat4" target="_blank">vlog</a>
  </nav>
  
  <main>
    {{ content }}
  </main>
</body>
</html>
<script>
document.addEventListener('DOMContentLoaded', async () => {
  const response = await fetch('/assets/gallery.json');
  const images = await response.json();
  const params = new URLSearchParams(window.location.search);
  const page = parseInt(params.get('page')) || 1;

  const container = document.querySelector('.gallery');
  const nav = document.querySelector('.pagination');

  const start = (page - 1) * 6;
  const pageImages = images.slice(start, start + 6);

  let landscapeCount = 0;
  let loaded = 0;

  pageImages.forEach(img => {
    const figure = document.createElement('figure');
    const image = document.createElement('img');
    const caption = document.createElement('figcaption');

    image.src = img.src;
    image.alt = img.caption;
    caption.textContent = img.caption;

    image.onload = () => {
      if (image.naturalWidth >= image.naturalHeight) {
        landscapeCount++;
      }

      loaded++;

      // Once all images are loaded, decide layout
      if (loaded === pageImages.length) {
        if (landscapeCount >= pageImages.length / 2) {
          container.classList.add('two-by-two');
          renderImages(pageImages.slice(0, 4));
        } else {
          container.classList.add('three-by-two');
          renderImages(pageImages);
        }
      }
    };

    function renderImages(imgs) {
      container.innerHTML = '';
      imgs.forEach(i => {
        const f = document.createElement('figure');
        const im = document.createElement('img');
        const cap = document.createElement('figcaption');

        im.src = i.src;
        im.alt = i.caption;
        cap.textContent = i.caption;

        f.appendChild(im);
        f.appendChild(cap);
        container.appendChild(f);
      });
    }
  });

  // Pagination
  if (page > 1) {
    const prev = document.createElement('a');
    prev.href = `?page=${page - 1}`;
    prev.textContent = '← Previous';
    nav.appendChild(prev);
  }

  if (start + 6 < images.length) {
    const next = document.createElement('a');
    next.href = `?page=${page + 1}`;
    next.textContent = 'Next →';
    nav.appendChild(next);
  }
});
</script>
