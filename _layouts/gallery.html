<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ page.title }}</title>
  <link rel="stylesheet" href="{{ '/assets/css/gallery.css' | relative_url }}">
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond&display=swap" rel="stylesheet">
</head>
<body>
  <nav class="topnav">
    <a class="brand" href="https://natdosan.github.io">natdosan</a>
    <a class="vlog" href="https://www.youtube.com/@swagmasternat4" target="_blank">vlog</a>
  </nav>
  
  <main>
    {{ content }}
  </main>
</body>
</html>
<script>
document.addEventListener('DOMContentLoaded', async () => {
  const response = await fetch('/assets/gallery.json');
  const images = await response.json();

  const params = new URLSearchParams(window.location.search);
  const page = parseInt(params.get('page')) || 1;

  const container = document.querySelector('.gallery');
  const nav = document.querySelector('.pagination');

  const pageSize = 6;
  const start = (page - 1) * pageSize;
  const pageImages = images.slice(start, start + pageSize);

  // --- Render immediately ---
  pageImages.forEach(img => {
    const figure = document.createElement('figure');
    const image = document.createElement('img');
    const caption = document.createElement('figcaption');

    image.src = img.src;
    image.alt = img.caption;
    image.loading = 'lazy';
    image.decoding = 'async';

    caption.textContent = img.caption;

    figure.appendChild(image);
    figure.appendChild(caption);
    container.appendChild(figure);
  });

  // --- Detect orientation AFTER render ---
  let landscapeCount = 0;
  let checked = 0;

  container.querySelectorAll('img').forEach(img => {
    if (img.complete) {
      check(img);
    } else {
      img.onload = () => check(img);
    }
  });

  function check(img) {
    if (img.naturalWidth >= img.naturalHeight) {
      landscapeCount++;
    }
    checked++;

    if (checked === pageImages.length) {
      applyLayout();
    }
  }

  function applyLayout() {
    container.classList.remove('two-by-two', 'three-by-two');

    if (landscapeCount >= pageImages.length / 2) {
      container.classList.add('two-by-two');

      // hide last two images instead of rerendering
      [...container.children].forEach((fig, i) => {
        fig.style.display = i < 4 ? '' : 'none';
      });
    } else {
      container.classList.add('three-by-two');
    }
  }

  // --- Pagination ---
  if (page > 1) {
    const prev = document.createElement('a');
    prev.href = `?page=${page - 1}`;
    prev.textContent = '← Previous';
    nav.appendChild(prev);
  }

  if (start + pageSize < images.length) {
    const next = document.createElement('a');
    next.href = `?page=${page + 1}`;
    next.textContent = 'Next →';
    nav.appendChild(next);
  }
});
</script>

